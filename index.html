<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Student Attendance System </title>
  <link rel="shortcut icon" href="./fav_icon.jpg" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tab-active { @apply font-bold border-b-2 border-purple-600 text-purple-700; }
    #reportView .sticky-col { position: sticky; left: 0; z-index: 10; background-color: white; }
    #reportTableHeader th { position: sticky; top: 0; z-index: 20; background-color: #f3f4f6; }
    #reportTableHeader .sticky-col { z-index: 30 !important; background-color: #f3f4f6; }
  </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-white text-gray-800 font-sans min-h-screen p-4">

<section id="authPage" class="flex items-center justify-center min-h-screen">
  <div class="bg-white p-6 sm:p-10 rounded-3xl shadow-2xl w-full max-w-md transform transition-all duration-300 hover:shadow-purple-300/50">
    <div class="text-center mb-6">
        <h1 class="text-3xl font-extrabold text-purple-700">Attendance System</h1>
        <p class="text-gray-500">Sign in or register to continue</p>
    </div>
    <div class="flex justify-around mb-6 border-b border-gray-200">
      <button id="signInTab" class="tab-active px-4 py-2 text-lg hover:text-purple-700 transition-colors duration-200">Sign In</button>
      <button id="signUpTab" class="px-4 py-2 text-lg text-gray-500 hover:text-purple-700 transition-colors duration-200">Sign Up</button>
    </div>

    <form id="signInForm" class="space-y-6">
      <div>
        <label for="loginUsername" class="block text-sm font-medium text-gray-700">Username</label>
        <input id="loginUsername" type="text" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition duration-150" required>
      </div>
      <div>
        <label for="loginPassword" class="block text-sm font-medium text-gray-700">Password</label>
        <input id="loginPassword" type="password" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition duration-150" required>
      </div>
      <div>
        <label for="loginRole" class="block text-sm font-medium text-gray-700">Role</label>
        <select id="loginRole" class="mt-1 border border-gray-300 w-full p-3 rounded-lg bg-white focus:ring-purple-500 focus:border-purple-500 transition duration-150" required>
            <option value="student">Student</option>
            <option value="admin">Admin</option>
        </select>
      </div>
      <button type="submit" class="w-full bg-purple-600 text-white font-semibold py-3 rounded-lg hover:bg-purple-700 shadow-lg transition duration-200 transform hover:scale-[1.01]">Sign In</button>
    </form>

    <form id="signUpForm" class="space-y-4 hidden">
      <div>
        <label class="block text-sm font-medium text-gray-700">Student ID</label>
        <input id="signUpId" type="text" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Name</label>
        <input id="signUpName" type="text" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Email (Gmail for notification)</label>
        <input id="signUpEmail" type="email" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Photo (Optional File Upload)</label>
        <input id="signUpPhotoFile" type="file" accept="image/*"
               class="mt-1 border border-gray-300 w-full p-3 rounded-lg bg-white focus:ring-green-500 focus:border-green-500 transition duration-150">
        <p class="text-xs text-gray-500 mt-1">Max 5MB. Must be uploaded before registration completes.</p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Class</label>
        <input id="signUpClass" type="text" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Username</label>
        <input id="signUpUsername" type="text" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Password</label>
        <input id="signUpPassword" type="password" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150" required>
      </div>
      <button type="submit" id="signUpSubmitBtn" class="w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700 shadow-lg transition duration-200 transform hover:scale-[1.01]">Sign Up</button>
    </form>
  </div>
</section>

<section id="adminDashboard" class="hidden py-8">
  <header class="max-w-6xl mx-auto mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 p-4 bg-white rounded-3xl shadow-xl">
    <h1 class="text-3xl font-extrabold text-purple-700">Admin Dashboard</h1>
    <div class="flex flex-wrap gap-3">
      <button id="addBtn" class="bg-purple-600 text-white px-5 py-2 rounded-lg hover:bg-purple-700 transition duration-200 flex items-center gap-1">+ Add Student</button>
      <button id="logoutBtnAdmin" class="border border-gray-300 text-gray-700 px-5 py-2 rounded-lg hover:bg-gray-100 transition duration-200">Logout</button>
    </div>
  </header>

  <main class="max-w-6xl mx-auto space-y-8">

    <div class="flex justify-start border-b border-gray-200">
        <button id="dailyTab" class="tab-active px-4 py-2 text-lg hover:text-purple-700 transition-colors duration-200">Daily Attendance</button>
        <button id="reportTab" class="px-4 py-2 text-lg text-gray-500 hover:text-purple-700 transition-colors duration-200">Monthly Report</button>
    </div>

    <div id="dailyView" class="space-y-8">
        
        <div class="bg-white p-4 rounded-3xl shadow-xl flex items-center space-x-4">
            <label for="attendanceDate" class="text-lg font-bold text-purple-700">Select Date:</label>
            <input type="date" id="attendanceDate" 
                   class="border border-gray-300 p-3 rounded-lg bg-white focus:ring-purple-500 focus:border-purple-500"
                   required/>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div class="bg-white p-6 rounded-3xl shadow-xl border-l-4 border-teal-500">
                <p class="text-sm font-medium text-gray-500">Total Students</p>
                <p id="totalCount" class="text-3xl font-bold text-purple-700 mt-1">0</p>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-xl border-l-4 border-green-500">
                <p class="text-sm font-medium text-gray-500">Present on Date</p>
                <p id="presentCount" class="text-3xl font-bold text-green-600 mt-1">0</p>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-xl border-l-4 border-red-500">
                <p class="text-sm font-medium text-gray-500">Absent on Date</p>
                <p id="absentCount" class="text-3xl font-bold text-red-600 mt-1">0</p>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-xl border-l-4 border-yellow-500">
                <p class="text-sm font-medium text-gray-500">Email Notifications Sent (Today)</p>
                <p id="notificationCount" class="text-3xl font-bold text-yellow-700 mt-1">0</p>
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-xl p-6">
          <h2 class="text-xl font-bold mb-4 text-purple-700 border-b pb-2">Pending Attendance Requests</h2>
          <div class="overflow-x-auto">
            <table class="w-full border-collapse">
              <thead>
                <tr class="bg-gray-100 text-left text-sm text-gray-600">
                  <th class="p-3 border-b border-gray-200 rounded-tl-lg">ID</th>
                  <th class="p-3 border-b border-gray-200">Name</th>
                  <th class="p-3 border-b border-gray-200">Class</th>
                  <th class="p-3 border-b border-gray-200 rounded-tr-lg">Action</th>
                </tr>
              </thead>
              <tbody id="pendingTable"></tbody>
            </table>
            <p id="noPendingRequests" class="text-center py-4 text-gray-500 hidden">No pending requests.</p>
          </div>
        </div>
        
        <div class="bg-white rounded-3xl shadow-xl p-6">
            <h2 class="text-xl font-bold mb-4 text-purple-700 border-b pb-2">Manual Email Notification Control (3+ Consecutive Absences)</h2>
            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-gray-100 text-left text-sm text-gray-600">
                            <th class="p-3 border-b border-gray-200 rounded-tl-lg">ID</th>
                            <th class="p-3 border-b border-gray-200">Name</th>
                            <th class="p-3 border-b border-gray-200">Last Absent Date</th>
                            <th class="p-3 border-b border-gray-200">Status</th>
                            <th class="p-3 border-b border-gray-200 rounded-tr-lg">Action</th>
                        </tr>
                    </thead>
                    <tbody id="notificationTableBody"></tbody>
                </table>
                <p id="noNotificationNeeded" class="text-center py-4 text-gray-500 hidden">No students require urgent email notification today.</p>
            </div>
        </div>


        <div class="bg-white rounded-3xl shadow-xl p-6">
          <h2 class="text-xl font-bold mb-4 text-purple-700 border-b pb-2">Attendance for Selected Date</h2>

          <div class="flex flex-col lg:flex-row justify-between mb-4 gap-4">
            <div class="flex flex-col sm:flex-row gap-2 flex-1 max-w-lg">
              <input id="scanInput" type="text" placeholder="Scan or Enter Student ID"
                     class="border border-gray-300 p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 flex-1"
                     onkeyup="this.value = this.value.toUpperCase()">
              <button id="scanBtn" class="bg-green-600 text-white px-5 py-3 rounded-lg hover:bg-green-700 transition duration-200 w-full sm:w-auto font-semibold">Mark / Undo</button>
            </div>
            <div class="flex items-center space-x-3">
              <label for="filterStatus" class="text-sm font-medium text-gray-700">Filter by status:</label>
              <select id="filterStatus" class="border border-gray-300 p-3 rounded-lg bg-white focus:ring-purple-500 focus:border-purple-500">
                <option value="all">All</option>
                <option value="present">Present</option>
                <option value="absent">Absent</option>
              </select>
            </div>
          </div>

          <div class="overflow-x-auto">
            <table class="w-full border-collapse">
              <thead>
                <tr class="bg-gray-100 text-left text-sm text-gray-600">
                  <th class="p-3 border-b border-gray-200 rounded-tl-lg">Photo</th>
                  <th class="p-3 border-b border-gray-200">ID</th>
                  <th class="p-3 border-b border-gray-200">Name</th>
                  <th class="p-3 border-b border-gray-200">Class</th>
                  <th class="p-3 border-b border-gray-200">Status</th>
                  <th class="p-3 border-b border-gray-200 rounded-tr-lg">Action</th>
                </tr>
              </thead>
              <tbody id="studentTable"></tbody>
            </table>
          </div>
        </div>
    </div>


    <div id="reportView" class="space-y-6 hidden">
        <div class="bg-white rounded-3xl shadow-xl p-6">
            <h2 class="text-xl font-bold mb-4 text-purple-700 border-b pb-2">Monthly Attendance Overview</h2>
            
            <div class="mb-4 flex items-center space-x-3">
                <label for="reportMonth" class="text-sm font-medium text-gray-700">Select Month:</label>
                <input type="month" id="reportMonth" 
                       class="border border-gray-300 p-3 rounded-lg bg-white focus:ring-purple-500 focus:border-purple-500"/>
            </div>
            <p id="reportSummary" class="text-sm text-gray-500 mb-4"></p>

            <div class="overflow-x-auto overflow-y-auto max-h-[70vh] border rounded-lg shadow-inner">
                <table class="w-full border-collapse">
                    <thead id="reportTableHeader"></thead>
                    <tbody id="reportTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
  </main>
</section>

<section id="studentDashboard" class="hidden py-8">
  <header class="max-w-6xl mx-auto mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 p-4 bg-white rounded-3xl shadow-xl">
    <h1 class="text-3xl font-extrabold text-purple-700">My Attendance</h1>
    <button id="logoutBtnStudent" class="border border-gray-300 text-gray-700 px-5 py-2 rounded-lg hover:bg-gray-100 transition duration-200">Logout</button>
  </header>

  <main class="max-w-6xl mx-auto bg-white rounded-3xl shadow-xl p-6">
    <h2 class="text-xl font-bold mb-4 text-purple-700 border-b pb-2">Request Attendance</h2>
    <div class="mb-6 flex flex-col sm:flex-row gap-3">
      <input id="scanInputStudent" placeholder="Enter your Student ID (e.g. STU001)"
             class="border border-gray-300 p-3 rounded-lg flex-1 focus:ring-purple-500 focus:border-purple-500"
             onkeyup="this.value = this.value.toUpperCase()"/>
      <button id="requestBtn" class="bg-blue-600 text-white px-5 py-3 rounded-lg hover:bg-blue-700 transition duration-200 w-full sm:w-auto font-semibold">Request Attendance</button>
    </div>
    <p id="requestMsg" class="text-sm text-gray-600 mb-6"></p>

    <h2 class="text-xl font-bold mb-4 text-purple-700 border-b pb-2">My Current Status</h2>
    <div class="overflow-x-auto">
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-gray-100 text-left text-sm text-gray-600">
            <th class="p-3 border-b border-gray-200">Photo</th>
            <th class="p-3 border-b border-gray-200 rounded-tl-lg">ID</th>
            <th class="p-3 border-b border-gray-200">Name</th>
            <th class="p-3 border-b border-gray-200">Class</th>
            <th class="p-3 border-b border-gray-200 rounded-tr-lg">Status</th>
          </tr>
        </thead>
        <tbody id="studentSelfTable"></tbody>
      </table>
    </div>
  </main>
</section>

<div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
  <div class="bg-white rounded-3xl p-6 w-full max-w-md shadow-2xl transform transition-transform duration-300 scale-95" id="modalContent">
    <h2 class="text-2xl font-bold text-purple-700 mb-5">Add New Student</h2>
    <form id="addForm" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Student ID (Will be Username/Password)</label>
        <input id="stuId" type="text" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500" required onkeyup="this.value = this.value.toUpperCase()">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Name</label>
        <input id="stuName" type="text" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Email (Gmail for notification)</label>
        <input id="stuEmail" type="email" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Photo (Optional File Upload)</label>
        <input id="stuPhotoFile" type="file" accept="image/*"
               class="mt-1 border border-gray-300 w-full p-3 rounded-lg bg-white focus:ring-purple-500 focus:border-purple-500 transition duration-150">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Class</label>
        <input id="stuClass" type="text" class="mt-1 border border-gray-300 w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500" required>
      </div>
      <div class="flex justify-end space-x-3 pt-4">
        <button type="button" id="cancelBtn" class="px-5 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition duration-200">Cancel</button>
        <button type="submit" id="addSubmitBtn" class="bg-purple-600 text-white px-5 py-2 rounded-lg hover:bg-purple-700 transition duration-200">Save Student</button>
      </div>
    </form>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>